<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Testing WildFly applications on Kubernetes with Arquillian Cube</title>
  <meta name="description" content="">
  <link rel="me" href="https://fosstodon.org/@wildflyas" />
  <link rel="shortcut icon" type="image/png" href="/wildfly.org/favicon.ico" >
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/base16/atelier-dune-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/protobuf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/dockerfile.min.js"></script>
  <link rel="stylesheet" href="/wildfly.org/assets/css/main.css" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-40221748-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-40221748-1');
  </script>

  

</head>

<body class="Testing WildFly applications on Kubernetes with Arquillian Cube">
  <div class="content">
    <div class="header navigation">
  <div class="logo-wrapper">
    <a href="/wildfly.org/"><img class="wf-logo" src="/wildfly.org/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/wildfly.org/news/" class="active">News</a>
        </li>
        <li>
          <a href="/wildfly.org/about/" class="">About</a>
        </li>
        <li>
          <a href="/wildfly.org/contribute/" class="">Contribute</a>
        </li>
        <li>
            <a target="_blank" href="https://docs.wildfly.org">Docs</a>
        </li>
        <li>
          <a href="/wildfly.org/guides/" class="">Guides</a>
        </li>
        <li>
          <a href="/wildfly.org/events/" class="">Events</a>
        </li>
        <li>
          <a href="/wildfly.org/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/wildfly.org/security/" class="">CVE Reporting</a>
        </li>
        <li>
          <a href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
        <li>
          <a class="button-cta secondary " href="/wildfly.org/get-started/">Get Started</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12">
    <h1 class="title">Testing WildFly applications on Kubernetes with Arquillian Cube</h1>
    
    
    

    <p>
      
        <p class="byline">By Fabio Burzigotti | March 06, 2025</p>
      
    </p>
  </div>
  <div class="grid__item width-10-12 doc-content">
    
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Recently we blogged about testing WildFly on Docker effectively and easily, thanks to Arquillian Cube, now it&#8217;s time to make it Kubernetes!</p>
</div>
<div class="paragraph">
<p>In the <a href="https://www.wildfly.org/news/2025/01/27/testing-on-docker-with-cube/">Testing WildFly applications on Docker with Arquillian Cube</a>
article we saw how an Arquillian Cube test can be implemented to automate the build and execution of a Docker image that
contains a WildFly deployment, and to run tests against it.</p>
</div>
<div class="paragraph">
<p>This time we&#8217;ll see how a very similar process can be used to set up an automated integration test for a WildFly
application that should instead be run on Kubernetes.</p>
</div>
<div class="paragraph">
<p>Our goal is to provide an automated solution to replace the final part of the
<a href="https://www.wildfly.org/guides/get-started-microservices-on-kubernetes/simple-microservice-part2">WildFly Java Microservice - PART 2: Kubernetes</a>
guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case">Use case</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://www.wildfly.org/guides/get-started-microservices-on-kubernetes/simple-microservice-part2">WildFly Java Microservice - PART 2: Kubernetes</a>
guide uses an existing Docker image, pushes it to Quay.io, and then shows how to create Kubernetes resources, namely a
<code>Deployment</code> that manages the WildFly application workload, and a <code>NodePort</code> type <code>Service</code> that exposes it externally.</p>
</div>
<div class="paragraph">
<p>That&#8217;s cool!&#8230;&#8203; but still, it is based on manual steps.</p>
</div>
<div class="paragraph">
<p>In order to automate this, we&#8217;ll modify the example application that we showcased in
<a href="https://www.wildfly.org/news/2025/01/27/testing-on-docker-with-cube/">our previous article</a>,
to add a JUnit test, powered by Arquillian Cube, that will automate the Kubernetes resources creation, starting from
existing YAML definitions, and use APIs and annotations at the test class level.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="step-by-step-changes">Step by step changes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As said, we will to start from the
<a href="https://www.wildfly.org/news/2025/01/27/testing-on-docker-with-cube/">Testing WildFly applications on Docker with Arquillian Cube</a> article, so make sure to go through it, and maybe create a separate Git repo, or branch if you want to keep working on
both examples, then&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="kubernetes-resources-definition">Kubernetes resources definition</h3>
<div class="paragraph">
<p>Let&#8217;s copy/paste the YAML definition which is used in
<a href="https://www.wildfly.org/guides/get-started-microservices-on-kubernetes/simple-microservice-part2">WildFly Java Microservice - PART 2: Kubernetes</a> into a <em>kubernetes.yaml</em> file, that we&#8217;ll place in our project <code>test/resources</code> folder.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll modify the <code>Deployment</code> name, but it is basically the same as the one in the guide:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-jaxrs-app-deployment
  labels:
    app: my-jaxrs-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-jaxrs-app
  template:
    metadata:
      labels:
        app: my-jaxrs-app
    spec:
      containers:
      - name: my-jaxrs-app
        image: quay.io/tborgato/my-jaxrs-app
        ports:
        - containerPort: 8080
        - containerPort: 9990
        livenessProbe:
          httpGet:
            path: /health/live
            port: 9990
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 9990
        startupProbe:
          httpGet:
            path: /health/started
            port: 9990</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then - similarly to what is manually done in the WildFly miniseries guide - let&#8217;s add a Kubernetes <code>Service</code> resource
definition, by appending it to the same file. Here as well, we&#8217;ll use a meaningful name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: my-jaxrs-app-service
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 8080
  selector:
    app: my-jaxrs-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>The whole <em>kubernetes.yaml</em> file will now look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: my-jaxrs-app-service
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 8080
  selector:
    app: my-jaxrs-app
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-jaxrs-app-deployment
  labels:
    app: my-jaxrs-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: my-jaxrs-app
  template:
    metadata:
      labels:
        app: my-jaxrs-app
    spec:
      containers:
      - name: my-jaxrs-app
        image: quay.io/tborgato/my-jaxrs-app
        ports:
        - containerPort: 8080
        - containerPort: 9990
        livenessProbe:
          httpGet:
            path: /health/live
            port: 9990
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 9990
        startupProbe:
          httpGet:
            path: /health/started
            port: 9990</code></pre>
</div>
</div>
<div class="paragraph">
<p>and, rather than applying it manually to our <em>Minikube</em> instance via a <code>kubectl</code> command, we&#8217;ll let Arquillian Cube do the job!</p>
</div>
<div class="paragraph">
<p>Specifically, Arquillian Cube provides several ways to automate your Kubernetes tests - including a
<a href="http://arquillian.org/arquillian-cube/#<em>jkube_kubernetes_openshift_maven_plugin_integration_with_cube">JKube plugin
integration</a> - but we&#8217;ll use the most common approach in this example, i.e. using a _kubernetes.yaml</em> definition in the
classpath.</p>
</div>
<div class="paragraph">
<p>If such a definition exists, then Arquillian Cube will apply it to the cluster, and it will provide us with APIs and
annotations at the class level that we&#8217;ll use to wire the test logic up, as we&#8217;ll see later on.</p>
</div>
</div>
<div class="sect2">
<h3 id="update-the-example-project-pom">Update the example project POM</h3>
<div class="paragraph">
<p>A few changes, provided we started from the previous article about
<a href="https://www.wildfly.org/news/2025/01/27/testing-on-docker-with-cube/">Testing WildFly applications on Docker with Arquillian Cube</a>.</p>
</div>
<div class="paragraph">
<p>The first thing we need to do is to add a couple more properties for two new dependencies that we&#8217;ll need to add; details
are explained later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;fabric8.kubernetes-client.version&gt;6.9.2&lt;/fabric8.kubernetes-client.version&gt;
    &lt;undertow-core.version&gt;1.3.33.Final&lt;/undertow-core.version&gt;
    &lt;resteasy-client.version&gt;6.2.11.Final&lt;/resteasy-client.version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, in order to make our project POM more readable, we should <strong>remove</strong> the code that we commented out
<a href="https://www.wildfly.org/news/2025/01/27/testing-on-docker-with-cube/">in the above-mentioned article</a>, so let&#8217;s start
by removing the following block in the <code>&lt;dependencyManagment&gt;</code> section, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- Arquillian Cube still using JUnit 4 by default --&gt;
        &lt;!--            &amp;lt;!&amp;ndash;Define the JUnit5 bom. WildFly BOM still contains JUnit4, so we have to declare a version here &amp;ndash;&amp;gt;--&gt;
        &lt;!--            &lt;dependency&gt;--&gt;
        &lt;!--                &lt;groupId&gt;org.junit&lt;/groupId&gt;--&gt;
        &lt;!--                &lt;artifactId&gt;junit-bom&lt;/artifactId&gt;--&gt;
        &lt;!--                &lt;version&gt;${version.junit5}&lt;/version&gt;--&gt;
        &lt;!--                &lt;type&gt;pom&lt;/type&gt;--&gt;
        &lt;!--                &lt;scope&gt;import&lt;/scope&gt;--&gt;
        &lt;!--            &lt;/dependency&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then, let&#8217;s <strong>remove</strong> the commented out fragments in the <code>&lt;build&gt;/&lt;dependencies&gt;</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- Test scope dependencies --&gt;
        &lt;!-- Arquillian Cube still using JUnit 4 by default --&gt;
        &lt;!--        &lt;dependency&gt;--&gt;
        &lt;!--            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;--&gt;
        &lt;!--            &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;--&gt;
        &lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;
        &lt;!--        &lt;/dependency&gt;--&gt;

        &lt;!-- Not needed anymore because the test uses a standalone Docker container --&gt;
        &lt;!--        &lt;dependency&gt;--&gt;
        &lt;!--            &lt;groupId&gt;org.wildfly.arquillian&lt;/groupId&gt;--&gt;
        &lt;!--            &lt;artifactId&gt;wildfly-arquillian-container-managed&lt;/artifactId&gt;--&gt;
        &lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;
        &lt;!--        &lt;/dependency&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Done with removals.</p>
</div>
<div class="paragraph">
<p>Now, onto the <code>dependencyManagment</code> section, which also contains a definition of the wildfly-ee BOM,
used in <a href="https://www.wildfly.org/news/2025/01/27/testing-on-docker-with-cube/">our previous example</a>. We can comment that
out now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">            &lt;!-- The wildfly-ee BOM isn't needed, since we will not build any WildFly application, but rather use an
            existing image on Quay.io --&gt;
            &lt;!--&amp;lt;!&amp;ndash; JBoss distributes a complete set of Jakarta EE APIs including
                a Bill of Materials (BOM). A BOM specifies the versions of a "stack" (or
                a collection) of artifacts. We use this here so that we always get the correct
                versions of artifacts (you can read this as the WildFly stack of the Jakarta EE APIs,
                with some extras tools for your project, such as Arquillian for testing)
            &amp;ndash;&amp;gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.wildfly.bom&lt;/groupId&gt;
                &lt;artifactId&gt;wildfly-ee&lt;/artifactId&gt;
                &lt;version&gt;${version.wildfly.bom}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s move to the <code>dependencies</code> section, where we&#8217;ll first comment the Jakarta EE dependencies out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- No Jakarta EE application is built, so we don't need the dependencies that WildFly is meant to provide --&gt;
        &lt;!--&amp;lt;!&amp;ndash; Import the CDI API, we use provided scope as the API is included in WildFly &amp;ndash;&amp;gt;
        &lt;dependency&gt;
            &lt;groupId&gt;jakarta.enterprise&lt;/groupId&gt;
            &lt;artifactId&gt;jakarta.enterprise.cdi-api&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

        &amp;lt;!&amp;ndash; Import the JAX-RS API, we use provided scope as the API is included in WildFly &amp;ndash;&amp;gt;
        &lt;dependency&gt;
            &lt;groupId&gt;jakarta.ws.rs&lt;/groupId&gt;
            &lt;artifactId&gt;jakarta.ws.rs-api&lt;/artifactId&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next one is quite important from the Arquillian perspective: we&#8217;ll replace the dependency from the Arquillian Cube
Docker extension with the Arquillian Cube Kubernetes extension, so we&#8217;ll keep the following commented out
block in the example sources for clarity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- Here we'll depend on arquillian-cube-kubernetes, in order to test on Kubernetes, so let's remove arquillian-cube-docker... --&gt;
        &lt;!--&lt;dependency&gt;
                &lt;groupId&gt;org.arquillian.cube&lt;/groupId&gt;
                &lt;artifactId&gt;arquillian-cube-docker&lt;/artifactId&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.jboss.arquillian.junit&lt;/groupId&gt;
                &lt;artifactId&gt;arquillian-junit-container&lt;/artifactId&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;--&gt;
        &lt;!-- ... and depend on arquillian-cube-kubernetes instead, in order to test on Kubernetes. --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.arquillian.cube&lt;/groupId&gt;
            &lt;artifactId&gt;arquillian-cube-kubernetes&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.arquillian.cube&lt;/groupId&gt;
            &lt;artifactId&gt;arquillian-cube-kubernetes-starter&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.fabric8&lt;/groupId&gt;
            &lt;artifactId&gt;kubernetes-client&lt;/artifactId&gt;
            &lt;version&gt;${fabric8.kubernetes-client.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.undertow&lt;/groupId&gt;
            &lt;artifactId&gt;undertow-core&lt;/artifactId&gt;
            &lt;version&gt;${undertow-core.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we added the <code>arquillian-cube-kubernetes-starter</code> and <code>kubernetes-client</code> dependencies, too.
The former is needed to let Arquillian Cube automatically start the Kubernetes "container" (broader meaning here).
The latter provides us with all the Kubernetes APIs, which we&#8217;ll use in the test class, as we&#8217;ll see below.
We had to lock the <code>undertow-core</code> dependency version too, since we need one that is compatible with Arquillian Cube 2.0.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s remove the following JBoss Logging dependency, as it will not be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!--See https://issues.redhat.com/browse/WFLY-19779 and https://github.com/wildfly/quickstart/pull/957/
            httpclient needs commons-logging yet the server uses this instead,
            to be fully compatible on apps we need to add this dependency whenever commons-logging is needed,
            but on testing clients like this we could use commons-logging instead
        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging-jboss-logging&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>One last thing in the test dependencies section, let&#8217;s give a version to the RESTEasy client dependency, since we
removed the <code>wildfly&#8212;&#8203;ee</code> BOM from the <code>dependencyManagment</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
            &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
            &lt;!-- Add a version to the resteasy-client dependency, as the WildFly EE BOM has been removed from the
            dependencyManagement section --&gt;
            &lt;version&gt;${resteasy-client.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, onto the <code>&lt;build&gt;/&lt;plugins&gt;</code> section. First off we don&#8217;t need for the <code>maven-clean-plugin</code> to clean up any
Docker files; in fact we&#8217;ll remove those from our project sources later on, since this test will not build nor run any
Docker images. Let&#8217;s comment the section as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- No Docker resources are used in the test, so we don't need to clean up anything else --&gt;
        &lt;!--&amp;lt;!&amp;ndash; Let's remove ./docker-build/server, too &amp;ndash;&amp;gt;
        &lt;configuration&gt;
            &lt;filesets&gt;
                &lt;fileset&gt;
                    &lt;directory&gt;${project.basedir}/docker-build/server&lt;/directory&gt;
                &lt;/fileset&gt;
            &lt;/filesets&gt;
        &lt;/configuration&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we should remove the WildFly Maven plugin definition, too, as this a Kubernetes test, which will rely on an
image that is deployed to Quay.io already, as per the
<a href="https://www.wildfly.org/guides/get-started-microservices-on-kubernetes/simple-microservice-part2#quay-io">WildFly Java
Microservice - PART 2: Kubernetes</a> original example. Let&#8217;s comment the whole plugin configuration out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- Not needed here, the test relies on an existing docker image which is deployed to Quay.io --&gt;
        &lt;!--&amp;lt;!&amp;ndash; The WildFly plugin deploys your war to a local JBoss AS container &amp;ndash;&amp;gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.wildfly.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;wildfly-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;${version.wildfly.maven.plugin}&lt;/version&gt;
            &lt;configuration&gt;
                &amp;lt;!&amp;ndash; We need for the server to be provisioned in ./docker-build/server, as required by the Dockerfile &amp;ndash;&amp;gt;
                &lt;provisioningDir&gt;${project.basedir}/docker-build/server&lt;/provisioningDir&gt;
                &lt;overwriteProvisionedServer&gt;true&lt;/overwriteProvisionedServer&gt;
                &lt;feature-packs&gt;
                    &lt;feature-pack&gt;
                        &lt;location&gt;org.wildfly:wildfly-galleon-pack:${version.wildfly.bom}&lt;/location&gt;
                    &lt;/feature-pack&gt;
                    &lt;feature-pack&gt;
                        &lt;location&gt;org.wildfly.cloud:wildfly-cloud-galleon-pack:7.0.2.Final&lt;/location&gt;
                    &lt;/feature-pack&gt;
                &lt;/feature-packs&gt;
                &lt;layers&gt;
                    &amp;lt;!&amp;ndash; layers may be used to customize the server to provision&amp;ndash;&amp;gt;
                    &lt;layer&gt;cloud-server&lt;/layer&gt;
                &lt;/layers&gt;
            &lt;/configuration&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;package&lt;/goal&gt;
                    &lt;/goals&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s comment the following section properties, too, since they&#8217;re no longer relevant nor used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- Wildfly dependencies are not used directly, as the test is using an existing WildFly application image --&gt;
        &lt;!--&amp;lt;!&amp;ndash; JBoss dependency versions &amp;ndash;&amp;gt;
        &lt;version.wildfly.maven.plugin&gt;5.1.1.Final&lt;/version.wildfly.maven.plugin&gt;
        &lt;version.wildfly.bom&gt;35.0.0.Final&lt;/version.wildfly.bom&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and similarly with the JUnit 5 related property, since we&#8217;re using JUnit 4:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">        &lt;!-- We don't need JUnit5, and this property is not used --&gt;
        &lt;!--&amp;lt;!&amp;ndash;Use JUnit 5 here - the WildFly bom still brings 4.x &amp;ndash;&amp;gt;
        &lt;version.junit5&gt;5.10.1&lt;/version.junit5&gt;--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s it, we&#8217;re done with the POM, and feel free to check your version against the example sources on GitHub, where
you can find a <a href="https://github.com/fabiobrz/wildfly-mini-series-k8s-cube/blob/main/pom.minified.xml">"minified"</a> version, too.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s get to the <code>arquillian.xml</code> file now, and see how should be modified.</p>
</div>
</div>
<div class="sect2">
<h3 id="update-arquillian-xml-configuration">Update <code>arquillian.xml</code> configuration</h3>
<div class="paragraph">
<p>A simple update will do, start by removing or commenting the <code>docker</code> extension part out: easy, we don&#8217;t need a <code>wildfly</code>
container anymore, so let&#8217;s remove it, and add a <code>kubernetes</code> extension declaration, which we&#8217;ll keep empty.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;!--&lt;extension qualifier="docker"&gt;
        &lt;property name="dockerContainersFile"&gt;./docker-compose.yml&lt;/property&gt;
    &lt;/extension&gt;--&gt;
    &lt;extension qualifier="kubernetes"&gt;
    &lt;/extension&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last part is about the test class itself, let&#8217;s dive in&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="remove-the-application-sources">Remove the application sources</h3>
<div class="paragraph">
<p>Again, we&#8217;re not building any application here. We rely on a Docker image on Quay that contains the application
already; therefore we don&#8217;t need the application sources, which can be safely removed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ rm -rf src/main/java/org
$ rm -rf src/main/webapp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-a-test-class-for-testing-on-kubernetes">Create a test class for testing on Kubernetes</h3>
<div class="paragraph">
<p>We must actually delete the existing Docker test, first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ rm src/test/java/org/wildfly/examples/GettingStartedDockerIT.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>and - as anticipated previously, we&#8217;ll now remove the Docker related resources, too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ rm -rf docker-build
$ rm docker-compose.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>There we go, now it&#8217;s time to create a new <code>GettingStartedKubernetesIT.java</code> class, with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.wildfly.examples;

import io.fabric8.kubernetes.api.model.Service;
import jakarta.ws.rs.client.Client;
import jakarta.ws.rs.client.ClientBuilder;
import jakarta.ws.rs.core.Response;
import org.arquillian.cube.kubernetes.annotations.Named;
import org.arquillian.cube.kubernetes.annotations.PortForward;
import org.jboss.arquillian.junit.Arquillian;
import org.jboss.arquillian.test.api.ArquillianResource;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;

import java.net.URISyntaxException;
import java.net.URL;

import static junit.framework.TestCase.assertFalse;
import static org.junit.Assert.assertNotNull;

/**
 * Run integration tests on Kubernetes with Arquillian Cube!
 */
@RunWith(Arquillian.class)
public class GettingStartedKubernetesIT {

    @Named("my-jaxrs-app-service")
    @ArquillianResource
    private Service myJaxrsAppService;

    @Named("my-jaxrs-app-service")
    @PortForward
    @ArquillianResource
    private URL url;

    @Test
    public void shouldFindServiceInstance() {
        assertNotNull(myJaxrsAppService);
        assertNotNull(myJaxrsAppService.getSpec());
        assertNotNull(myJaxrsAppService.getSpec().getPorts());
        assertFalse(myJaxrsAppService.getSpec().getPorts().isEmpty());
    }

    @Test
    public void shouldShowHelloWorld() throws URISyntaxException {
        assertNotNull(url);
        try (Client client = ClientBuilder.newClient()) {
            final String name = "World";
            Response response = client
                    .target(url.toURI())
                    .path("/hello/" + name)
                    .request()
                    .get();
            Assert.assertEquals(200, response.getStatus());
            Assert.assertEquals(String.format("Hello '%s'.", name), response.readEntity(String.class));
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the test didn&#8217;t change much from the one in the
<a href="https://www.wildfly.org/news/2025/01/27/testing-on-docker-with-cube/">Testing WildFly applications on Docker with
Arquillian Cube</a> example:
we verify that the service - which is implemented by a Kubernetes workload - returns HTTP 200 and the expected response
body when it is called via its URL.</p>
</div>
<div class="paragraph">
<p>And that is where Arquillian Cube comes in handy because, thanks to it, we could inject such a URL in our test class
<code>url</code> <em>field</em> just by using an annotation.
Similarly, we have injected an <code>io.fabric8.kubernetes.api.model.Service</code> instance which represents the Kubernetes
service resource that we Arquillian Cube creates based on the <em>kubernetes.yaml</em> definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="run-the-test">Run the test</h3>
<div class="paragraph">
<p>That&#8217;s it, we can run our Kubernetes integration test. Arquillian Cube will use the information stored in the
~/.kube/config file to connect to a Kubernetes cluster, or
<a href="http://arquillian.org/arquillian-cube/#_kubernetes_configuration_parameters">let you provide parameters</a>.
For this example, starting a <a href="https://minikube.sigs.k8s.io/docs/"><code>minikube</code></a> instance will be enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">minikube start</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then issue the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>and we&#8217;ll see how Arquillian Cube will gather the kubernetes extension configuration, then summarize the container
definition, trace the resources creation on the cluster, and eventually run the test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.wildfly.examples.GettingStartedKubernetesIT
...
CubeKubernetesConfiguration:
  namespace = itest-4d12b880
  master.url = https://192.168.39.213:8443/
  namespace.lazy.enabled = true
  namespace.cleanup.enabled = true
  namespace.cleanup.timeout = 0
  namespace.cleanup.confirm.enabled = false
  namespace.destroy.enabled = true
  namespace.destroy.confirm.enabled = false
  namespace.destroy.timeout = 0
  wait.enabled = true
  wait.timeout = 480000
  wait.poll.interval = 5000
  ansi.logger.enabled = true
  env.init.enabled = true
  logs.copy = false
  cube.api.version = v1
  cube.trust.certs = true
  cube.fmp.build = false
  cube.fmp.build.disable.for.mvn = false
  cube.fmp.pom.path = pom.xml
  cube.fmp.debug.output = false
  cube.fmp.logs = true

Initializing Session:4d12b880
Using Kubernetes at: https://192.168.39.213:8443/
Creating namespace: itest-4d12b880...
To switch to the new namespace: kubectl config set-context `kubectl config current-context` --namespace=itest-4d12b880
Applying kubernetes configuration from: file:/home/fburzigo/Projects/git/fabiobrz/wfly-mini-k8s-cube/getting-started/target/test-classes/kubernetes.yaml
ReplicaSet: [my-jaxrs-app-deployment-56bbc54bf9]
Pod: [my-jaxrs-app-deployment-56bbc54bf9-zsc2m] Status: [Running]
Service: [my-jaxrs-app-service] IP: [10.111.189.164] Ports: [ 80 ]
Jan 31, 2025 4:49:45 PM org.arquillian.cube.kubernetes.impl.resources.KubernetesResourcesApplier applyKubernetesResourcesAtClassScope
INFO: Creating environment for org.wildfly.examples.GettingStartedKubernetesIT
Jan 31, 2025 4:49:45 PM org.arquillian.cube.kubernetes.impl.resources.KubernetesResourcesApplier applyKubernetesResourcesAtMethodScope
INFO: Creating environment for org.wildfly.examples.GettingStartedKubernetesIT method shouldShowHelloWorld
Jan 31, 2025 4:49:45 PM org.xnio.Xnio &lt;clinit&gt;
INFO: XNIO version 3.8.16.Final
Jan 31, 2025 4:49:45 PM org.xnio.nio.NioXnio &lt;clinit&gt;
INFO: XNIO NIO Implementation Version 3.8.16.Final
Jan 31, 2025 4:49:46 PM org.jboss.threads.Version &lt;clinit&gt;
INFO: JBoss Threads version 2.4.0.Final
Jan 31, 2025 4:49:46 PM org.arquillian.cube.kubernetes.impl.resources.KubernetesResourcesApplier removeKubernetesResourcesAtMethodScope
INFO: Deleting environment for org.wildfly.examples.GettingStartedKubernetesIT method shouldShowHelloWorld
Jan 31, 2025 4:49:46 PM org.arquillian.cube.kubernetes.impl.resources.KubernetesResourcesApplier applyKubernetesResourcesAtMethodScope
INFO: Creating environment for org.wildfly.examples.GettingStartedKubernetesIT method shouldFindServiceInstance
Jan 31, 2025 4:49:46 PM org.arquillian.cube.kubernetes.impl.resources.KubernetesResourcesApplier removeKubernetesResourcesAtMethodScope
INFO: Deleting environment for org.wildfly.examples.GettingStartedKubernetesIT method shouldFindServiceInstance
Jan 31, 2025 4:49:46 PM org.arquillian.cube.kubernetes.impl.resources.KubernetesResourcesApplier removeKubernetesResourcesAtClassScope
INFO: Deleting environment for org.wildfly.examples.GettingStartedKubernetesIT
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 15.05 s -- in org.wildfly.examples.GettingStartedKubernetesIT
Deleting namespace: itest-4d12b880...
Namespace: itest-4d12b880, successfully deleted
Destroying Session:4d12b880
[INFO]
[INFO] Results:
[INFO]
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  18.281 s
[INFO] Finished at: 2025-01-31T16:49:47+01:00
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="in-conclusion">In conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Testing a WildFly application directly on Kubernetes will make the test more effective, and will allow prototyping and
make debugging easier.</p>
</div>
<div class="paragraph">
<p>Arquillian Cube provides an easy and effective way to test on Kubernetes, with almost no configuration and instrumentation
changes with respect to existing Arquillian based tests.</p>
</div>
<div class="paragraph">
<p>The code for the example application which is described in this article is here: <a href="https://github.com/fabiobrz/wildfly-mini-series-k8s-cube" class="bare">https://github.com/fabiobrz/wildfly-mini-series-k8s-cube</a></p>
</div>
<div class="paragraph">
<p>Fabio Burzigotti</p>
</div>
</div>
</div>
    
  </div>
</div>



  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/wildfly.org/"><img class="wf-logo" src="/wildfly.org/assets/img/wildfly_icons_one-color-logo.png"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">WildFly is fully open. All components are open source and follow a community-focused development process.<br/><br/>This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/wildfly/wildfly.org/fork' target='_blank'>fork it</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <strong>Navigation</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="/downloads">Downloads</a></li>
          
            <li><a href="https://docs.wildfly.org">Docs</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly">Github</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Contribute</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://issues.jboss.org/browse/WFLY">Submit a bug</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly/fork">Fork WildFly</a></li>
          
            <li><a href="https://twitter.com/WildFlyAS">Follow us</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Get Help</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://wildfly.zulipchat.com/">Join Zulip Chat</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <strong>Find more Red Hat Middleware Community Projects</strong>
        <ul class="footer-links">
          
            <li><a href="https://www.apiman.io/">APIMan</a></li>
          
            <li><a href="http://arquillian.org">Arquillian</a></li>
          
            <li><a href="https://github.com/ansible-middleware/wildfly">Ansible Collection for Wildfly</a></li>
          
            <li><a href="http://byteman.jboss.org/">Byteman</a></li>
          
            <li><a href="http://capedwarf.org/">CapeDwarf</a></li>
          
            <li><a href="https://github.com/alechenninger/chronicler">Chronicler</a></li>
          
            <li><a href="https://github.com/darcy-framework">Darcy</a></li>
          
            <li><a href="http://debezium.io/">Debezium</a></li>
          
            <li><a href="https://www.drools.org/">Drools</a></li>
          
            <li><a href="http://gatein.jboss.org/">GateIn</a></li>
          
            <li><a href="http://www.hawkular.org/">Hawkular</a></li>
          
            <li><a href="http://hawt.io/">Hawtio</a></li>
          
            <li><a href="http://hibernate.org/">Hibernate</a></li>
          
            <li><a href="http://www.infinispan.org/">Infinispan</a></li>
          
            <li><a href="https://developers.redhat.com/products/codeready-studio/overview">CodeReady Studio</a></li>
          
            <li><a href="http://forge.jboss.org/">JBoss Forge</a></li>
          
            <li><a href="https://github.com/jboss-logging">JBoss Logging</a></li>
          
            <li><a href="http://jbossremoting.jboss.org/">JBoss Remoting</a></li>
          
            <li><a href="https://www.jbpm.org/">jBPM</a></li>
          
            <li><a href="https://jsfunit.jboss.org/">JSFUnit</a></li>
          
            <li><a href="https://www.keycloak.org/">Keycloak</a></li>
          
            <li><a href="http://modcluster.io/">Mod Cluster</a></li>
          
            <li><a href="http://modeshape.jboss.org/">ModeShape</a></li>
          
            <li><a href="https://www.optaplanner.org/">OptaPlanner</a></li>
          
            <li><a href="https://quarkus.io/">Quarkus</a></li>
          
            <li><a href="http://resteasy.jboss.org/">RESTEasy</a></li>
          
            <li><a href="https://riftsaw.jboss.org/">Riftsaw</a></li>
          
            <li><a href="http://savara.jboss.org/">Savara</a></li>
          
            <li><a href="https://weld.cdi-spec.org/">Weld</a></li>
          
            <li><a href="http://arquillian.org/">Shrinkwrap</a></li>
          
            <li><a href="https://switchyard.jboss.org/">Switchyard</a></li>
          
            <li><a href="https://tattletale.jboss.org/">Tattletale</a></li>
          
            <li><a href="https://teiid.io/">Teiid</a></li>
          
            <li><a href="https://wildfly-security.github.io/wildfly-elytron/">WildFly Elytron</a></li>
          
            <li><a href="http://wise.jboss.org/">Wise</a></li>
          
            <li><a href="https://xnio.jboss.org/">XNIO</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/wildfly.org/assets/img/redhat_reversed.svg"></a>
    </span>
  </div>
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/wildfly.org/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/wildfly.org/assets/javascript/random-color-picker.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
    hljs.highlightAll();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
  <script type="text/javascript" src="/wildfly.org/assets/javascript/copy.js"></script>

</body>

</html>
